<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gerenciador de Tarefas</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h1>Hoje √© dia <span id="data-dia"></span></h1>

  <!-- P√°gina Principal -->
  <div id="main"></div>

  <!-- Nova Tarefa -->
  <div id="nova-tarefa" class="hidden">
    <h2>Nova Tarefa</h2>
    <form id="form-tarefa" onsubmit="criarTarefa(event)">
      <input type="text" id="titulo" placeholder="T√≠tulo da tarefa" required /><br>
      <input type="text" id="categoria" placeholder="Categoria (ex: Trabalho, Escola)" required /><br>
      <input type="date" id="prazo" /><br>
      <textarea id="descricao" placeholder="Descri√ß√£o detalhada"></textarea><br>
      <button type="submit">Adicionar</button>
    </form>
  </div>

  <!-- Configura√ß√µes -->
  <div id="configuracoes" class="hidden">
    <h2>Configura√ß√µes</h2>
    <button onclick="limparTarefas()">üóë Limpar todas as tarefas</button>
  </div>

  <!-- Menu inferior -->
  <div class="bottom-menu">
    <button onclick="mostrarAba('main')">üìÖ</button>
    <button onclick="mostrarAba('nova-tarefa')">Ôºã</button>
    <button onclick="mostrarAba('configuracoes')">‚öôÔ∏è</button>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("data-dia").textContent = new Date().getDate();
      carregarTarefas();
    });

    function mostrarAba(aba) {
      document.getElementById("main").classList.add("hidden");
      document.getElementById("nova-tarefa").classList.add("hidden");
      document.getElementById("configuracoes").classList.add("hidden");
      document.getElementById(aba).classList.remove("hidden");
    }

    function criarTarefa(event) {
      event.preventDefault();
      const titulo = document.getElementById("titulo").value.trim();
      const categoria = document.getElementById("categoria").value.trim();
      const prazo = document.getElementById("prazo").value;
      const descricao = document.getElementById("descricao").value.trim();

      const novaTarefa = { titulo, categoria, prazo, descricao };
      const tarefas = JSON.parse(localStorage.getItem("tarefas") || "[]");
      tarefas.push(novaTarefa);
      localStorage.setItem("tarefas", JSON.stringify(tarefas));

      adicionarTarefaNaTela(novaTarefa, tarefas.length - 1);
      document.getElementById("form-tarefa").reset();
      mostrarAba("main");
    }

    function adicionarTarefaNaTela(tarefa, index) {
      const taskCard = document.createElement("div");
      taskCard.className = "task-card";

      const titleElem = document.createElement("div");
      titleElem.className = "task-title";
      titleElem.textContent = tarefa.titulo;

      const catElem = document.createElement("div");
      catElem.className = "category";
      catElem.textContent = tarefa.categoria;
      if (tarefa.categoria.toLowerCase() === "escola") {
        catElem.classList.add("escola");
      }

      const toggleBtn = document.createElement("button");
      toggleBtn.className = "toggle-description";
      toggleBtn.innerHTML = '<i class="fas fa-chevron-right"></i>'; // √çcone de seta para a direita
      toggleBtn.onclick = () => {
        descElem.classList.toggle("active");
        const icon = toggleBtn.querySelector("i");
        if (descElem.classList.contains("active")) {
          icon.style.transform = "rotate(90deg)"; // Rota√ß√£o para baixo
        } else {
          icon.style.transform = "rotate(-90deg)"; // Rota√ß√£o para a direita
        }
      };

      const descElem = document.createElement("div");
      descElem.className = "description";
      descElem.innerHTML = tarefa.descricao
        ? `<p>${tarefa.descricao.replace(/\n/g, "<br>")}</p>`
        : "<p>Sem descri√ß√£o.</p>";

      const deleteBtn = document.createElement("button");
      deleteBtn.className = "delete-btn";
      deleteBtn.textContent = "Excluir";
      deleteBtn.onclick = () => excluirTarefa(index);

      descElem.appendChild(deleteBtn);

      taskCard.appendChild(titleElem);
      taskCard.appendChild(catElem);
      taskCard.appendChild(toggleBtn);

      if (tarefa.prazo) {
        const prazoElem = document.createElement("div");
        prazoElem.style.cssText = "position: absolute; right: 15px; bottom: 15px; font-size: 0.8em; color: #666;";
        prazoElem.textContent = calcularDiasRestantes(tarefa.prazo);
        taskCard.appendChild(prazoElem);
      }

      taskCard.appendChild(descElem);
      document.getElementById("main").appendChild(taskCard);
    }

    function calcularDiasRestantes(dataPrazo) {
      const hoje = new Date();
      const prazo = new Date(dataPrazo);

      // Calcula a diferen√ßa em dias
      const diff = Math.ceil((prazo - hoje) / (1000 * 60 * 60 * 24));

      if (diff > 0) {
        return `Restam ${diff} dia${diff === 1 ? "" : "s"}.`;
      } else if (diff === 0) {
        return "O prazo √© hoje!";
      } else {
        const diasAtrasados = Math.abs(diff);
        return `Atrasado h√° ${diasAtrasados} dia${diasAtrasados === 1 ? "" : "s"}.`;
      }
    }

    function carregarTarefas() {
      const tarefas = JSON.parse(localStorage.getItem("tarefas") || "[]");
      tarefas.forEach((tarefa, index) => adicionarTarefaNaTela(tarefa, index));
    }

    function excluirTarefa(index) {
      const tarefas = JSON.parse(localStorage.getItem("tarefas") || "[]");
      tarefas.splice(index, 1);
      localStorage.setItem("tarefas", JSON.stringify(tarefas));
      document.getElementById("main").innerHTML = "";
      carregarTarefas();
    }

    function limparTarefas() {
      if (confirm("Tem certeza que deseja excluir todas as tarefas?")) {
        localStorage.removeItem("tarefas");
        document.getElementById("main").innerHTML = "";
      }
    }
  </script>
</body>
</html>
